import './VulnerabilityReport.css'

interface VulnerabilityReportProps {
  report: {
    target: string
    timestamp: string
    riskLevel: 'low' | 'medium' | 'high' | 'critical'
    overallScore: number
    openPorts: {
      port: number
      service: string
      version?: string
      risk: 'low' | 'medium' | 'high'
    }[]
    technologies: {
      name: string
      version?: string
      category: string
    }[]
    vulnerabilities: {
      id: string
      title: string
      severity: 'low' | 'medium' | 'high' | 'critical'
      description: string
      recommendation: string
      cve?: string
    }[]
    securityHeaders: {
      present: string[]
      missing: string[]
      score: number
    }
    ssl: {
      enabled: boolean
      version?: string
      issuer?: string
      validUntil?: string
      issues: string[]
    }
    recommendations: string[]
  }
}

export default function VulnerabilityReport({ report }: VulnerabilityReportProps) {
  const getRiskColor = (risk: string) => {
    switch (risk) {
      case 'low':
        return '#10b981'
      case 'medium':
        return '#f59e0b'
      case 'high':
        return '#ef4444'
      case 'critical':
        return '#dc2626'
      default:
        return '#6b7280'
    }
  }

  const getRiskIcon = (risk: string) => {
    switch (risk) {
      case 'low':
        return '‚úÖ'
      case 'medium':
        return '‚ö†Ô∏è'
      case 'high':
        return 'üî¥'
      case 'critical':
        return 'üî•'
      default:
        return '‚ö™'
    }
  }

  return (
    <div className="vuln-report">
      {/* Header */}
      <div className="report-header">
        <h2>üîç Rapport de Vuln√©rabilit√©s</h2>
        <div className="target-info">
          <span className="target">{report.target}</span>
          <span className="timestamp">
            {new Date(report.timestamp).toLocaleString('fr-FR')}
          </span>
        </div>
      </div>

      {/* Score Global */}
      <div className="overall-score">
        <div className="score-circle">
          <svg viewBox="0 0 200 200">
            <circle
              cx="100"
              cy="100"
              r="90"
              fill="none"
              stroke="#e5e7eb"
              strokeWidth="20"
            />
            <circle
              cx="100"
              cy="100"
              r="90"
              fill="none"
              stroke={getRiskColor(report.riskLevel)}
              strokeWidth="20"
              strokeDasharray={`${(report.overallScore / 100) * 565} 565`}
              strokeLinecap="round"
              transform="rotate(-90 100 100)"
            />
            <text
              x="100"
              y="110"
              textAnchor="middle"
              fontSize="48"
              fontWeight="bold"
              fill={getRiskColor(report.riskLevel)}
            >
              {report.overallScore}
            </text>
          </svg>
        </div>
        <div className="score-info">
          <h3>Score de S√©curit√©</h3>
          <div
            className="risk-badge-large"
            style={{ backgroundColor: getRiskColor(report.riskLevel) }}
          >
            {getRiskIcon(report.riskLevel)} Risque: {report.riskLevel.toUpperCase()}
          </div>
          <p className="score-explanation">
            {report.overallScore >= 80 && 'Excellente s√©curit√© ! Quelques am√©liorations mineures possibles.'}
            {report.overallScore >= 60 && report.overallScore < 80 && 'S√©curit√© correcte mais des vuln√©rabilit√©s importantes existent.'}
            {report.overallScore >= 40 && report.overallScore < 60 && 'S√©curit√© insuffisante. Actions correctives n√©cessaires rapidement.'}
            {report.overallScore < 40 && 'ALERTE ROUGE : Vuln√©rabilit√©s critiques ! Action imm√©diate requise.'}
          </p>
        </div>
      </div>

      {/* Ports Ouverts */}
      {report.openPorts.length > 0 && (
        <div className="section">
          <h3>üîì Ports Ouverts ({report.openPorts.length})</h3>
          <div className="ports-grid">
            {report.openPorts.map((port, idx) => (
              <div
                key={idx}
                className="port-card"
                style={{ borderLeftColor: getRiskColor(port.risk) }}
              >
                <div className="port-number">{port.port}</div>
                <div className="port-service">{port.service}</div>
                {port.version && <div className="port-version">{port.version}</div>}
                <div
                  className="port-risk"
                  style={{ color: getRiskColor(port.risk) }}
                >
                  {getRiskIcon(port.risk)} {port.risk}
                </div>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* Technologies D√©tect√©es */}
      {report.technologies.length > 0 && (
        <div className="section">
          <h3>üîß Technologies D√©tect√©es</h3>
          <div className="tech-list">
            {report.technologies.map((tech, idx) => (
              <div key={idx} className="tech-badge">
                <span className="tech-name">{tech.name}</span>
                {tech.version && <span className="tech-version">v{tech.version}</span>}
                <span className="tech-category">{tech.category}</span>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* SSL/TLS */}
      <div className="section ssl-section">
        <h3>üîí SSL/TLS</h3>
        <div className="ssl-info">
          {report.ssl.enabled ? (
            <>
              <div className="ssl-enabled">
                ‚úÖ SSL/TLS Activ√©
                {report.ssl.version && <span className="ssl-version">{report.ssl.version}</span>}
              </div>
              {report.ssl.issuer && (
                <div className="ssl-detail">√âmetteur: {report.ssl.issuer}</div>
              )}
              {report.ssl.validUntil && (
                <div className="ssl-detail">
                  Valide jusqu'au: {new Date(report.ssl.validUntil).toLocaleDateString('fr-FR')}
                </div>
              )}
              {report.ssl.issues.length > 0 && (
                <div className="ssl-issues">
                  {report.ssl.issues.map((issue, idx) => (
                    <div key={idx} className="ssl-issue">‚ö†Ô∏è {issue}</div>
                  ))}
                </div>
              )}
            </>
          ) : (
            <div className="ssl-disabled">
              ‚ùå SSL/TLS Non Activ√© - Donn√©es transmises en clair
            </div>
          )}
        </div>
      </div>

      {/* Headers de S√©curit√© */}
      <div className="section">
        <h3>üõ°Ô∏è Headers de S√©curit√© HTTP</h3>
        <div className="headers-score">
          Score: {report.securityHeaders.score}%
        </div>
        <div className="headers-lists">
          {report.securityHeaders.present.length > 0 && (
            <div className="headers-present">
              <h4>‚úÖ Pr√©sents ({report.securityHeaders.present.length})</h4>
              <ul>
                {report.securityHeaders.present.map((header, idx) => (
                  <li key={idx}>{header}</li>
                ))}
              </ul>
            </div>
          )}
          {report.securityHeaders.missing.length > 0 && (
            <div className="headers-missing">
              <h4>‚ùå Manquants ({report.securityHeaders.missing.length})</h4>
              <ul>
                {report.securityHeaders.missing.map((header, idx) => (
                  <li key={idx}>{header}</li>
                ))}
              </ul>
            </div>
          )}
        </div>
      </div>

      {/* Vuln√©rabilit√©s */}
      {report.vulnerabilities.length > 0 && (
        <div className="section">
          <h3>‚ö†Ô∏è Vuln√©rabilit√©s D√©tect√©es ({report.vulnerabilities.length})</h3>
          <div className="vulnerabilities-list">
            {report.vulnerabilities.map((vuln, idx) => (
              <div
                key={idx}
                className="vuln-card"
                style={{ borderLeftColor: getRiskColor(vuln.severity) }}
              >
                <div className="vuln-header">
                  <span className="vuln-severity" style={{ color: getRiskColor(vuln.severity) }}>
                    {getRiskIcon(vuln.severity)} {vuln.severity.toUpperCase()}
                  </span>
                  {vuln.cve && <span className="vuln-cve">{vuln.cve}</span>}
                </div>
                <h4 className="vuln-title">{vuln.title}</h4>
                <p className="vuln-description">{vuln.description}</p>
                <div className="vuln-recommendation">
                  <strong>Recommandation:</strong> {vuln.recommendation}
                </div>
              </div>
            ))}
          </div>
        </div>
      )}

      {/* Recommandations Prioritaires */}
      {report.recommendations.length > 0 && (
        <div className="section recommendations-section">
          <h3>üí° Recommandations Prioritaires</h3>
          <div className="recommendations-list">
            {report.recommendations.map((rec, idx) => (
              <div key={idx} className="recommendation-item">
                {rec}
              </div>
            ))}
          </div>
        </div>
      )}

      {/* Footer */}
      <div className="report-footer">
        <p>
          Ce rapport a √©t√© g√©n√©r√© automatiquement par RiskyFillGen.
          Il est recommand√© de faire auditer votre syst√®me par un expert en cybers√©curit√©.
        </p>
        <button className="export-btn">üì• Exporter le Rapport (PDF)</button>
      </div>
    </div>
  )
}
